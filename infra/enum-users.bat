@echo off

:: Getting all groups
for /f "tokens=1* delims=*" %%S in ('net group /domain ^| findstr "\*"') do (
    :: Getting all users from all groups
    for /f "skip=8 tokens=1,2,3" %%G ('net group "%%S" /domain ^| findstr /I /V "Comando"') do (
    	echo %%G
    	echo %%H
    	echo %%I
    ) | findstr /I /V "ECHO" >> users.txt
)

:: Remove machines name from users list
type users.txt | findstr /I /V "\$" | sort /unique >> users_cleaned.txt
type users.txt | findstr /I "\$" | sort /unique >> machines_cleaned.txt

:: Cleanup the temp file;
del users.txt
::pause;

@echo on
