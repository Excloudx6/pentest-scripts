#!/bin/bash

echo -n "Updating files to Linux PrivEsc... "
rm -f "../infra/linux-privesc/lse.sh" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh" -o "../infra/linux-privesc/lse.sh"
chmod +x "../infra/linux-privesc/lse.sh"

rm -f "../infra/linux-privesc/LinEnum.sh" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh" -o "../infra/linux-privesc/LinEnum.sh"
chmod +x "../infra/linux-privesc/LinEnum.sh"

rm -f "../infra/linux-privesc/linpeas.sh" 2> /dev/null
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh" -o "../infra/linux-privesc/linpeas.sh"

rm -f ../infra/linux-privesc/{linuxprivchecker.sh,linuxprivchecker.py,linuxprivchecker_async.py}
curl -kLs "https://raw.githubusercontent.com/linted/linuxprivchecker/master/linuxprivchecker.sh" -o "../infra/linux-privesc/linuxprivchecker.sh"
curl -kLs "https://raw.githubusercontent.com/linted/linuxprivchecker/master/linuxprivchecker.py" -o "../infra/linux-privesc/linuxprivchecker.py"
curl -kLs "https://raw.githubusercontent.com/linted/linuxprivchecker/master/linuxprivchecker_async.py" -o "../infra/linux-privesc/linuxprivchecker_async.py"
chmod +x "../infra/linux-privesc/linuxprivchecker.sh"
chmod +x "../infra/linux-privesc/linuxprivchecker.py"
chmod +x "../infra/linux-privesc/linuxprivchecker_async.py"

rm -f "../infra/linux-privesc/unix-privesc-check-1.4.tar.gz" 2> /dev/null
curl -kLs "https://pentestmonkey.net/tools/unix-privesc-check/unix-privesc-check-1.4.tar.gz" -o "../infra/linux-privesc/unix-privesc-check-1.4.tar.gz"
echo "Done!"

echo -n "Updating files and binaries to Windows PrivEsc... "
rm -f ../infra/windows-privesc/{accesschk.exe,accesschk64.exe,accesschk64a.exe} 2> /dev/null
curl -kLs "https://download.sysinternals.com/files/AccessChk.zip" -o "../infra/windows-privesc/AccessChk.zip"
unzip -q -o -d ../infra/windows-privesc/ ../infra/windows-privesc/AccessChk.zip
rm -f ../infra/windows-privesc/{AccessChk.zip,Eula.txt} 2> /dev/null

rm -f "../infra/windows-privesc/mimikatz_trunk.zip" 2> /dev/null
mimikatz_download="$(curl -kLs https://github.com/gentilkiwi/mimikatz/releases/latest -o /dev/null -w "%{url_effective}\n" | sed "s/tag/download/")/mimikatz_trunk.zip"
curl -kLs "${mimikatz_download}" -o "../infra/windows-privesc/mimikatz_trunk.zip"

rm -f "../infra/windows-privesc/PrivescCheck.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1" -o "../infra/windows-privesc/PrivescCheck.ps1"

rm -f "../infra/windows-privesc/PowerUp.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1" -o "../infra/windows-privesc/PowerUp.ps1"

rm -f "../infra/windows-privesc/PowerView.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1" -o "../infra/windows-privesc/PowerView.ps1"

rm -f "../infra/windows-privesc/" 2> /dev/null
curl -kLs "https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Seatbelt.exe" -o "../infra/windows-privesc/Seatbelt.exe"

rm -f "../infra/windows-privesc/SharpHound.exe" 2> /dev/null
curl -kLs "https://github.com/BloodHoundAD/BloodHound/raw/master/Collectors/SharpHound.exe" -o "../infra/windows-privesc/SharpHound.exe"

rm -f "../infra/windows-privesc/SharpHound.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1" -o "../infra/windows-privesc/SharpHound.ps1"

rm -f "../infra/windows-privesc/SharUp.exe" 2> /dev/null
curl -kLs "https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/SharpUp.exe" -o "../infra/windows-privesc/SharpUp.exe"

rm -f "../infra/windows-privesc/Rubeus.exe" 2> /dev/null
curl -kLs "https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe" -o "../infra/windows-privesc/Rubeus.exe"

rm -f ../infra/windows-privesc/{winPEAS.bat,winPEASany.exe,winPEASx64_ofs.exe} 2> /dev/null
winPEAS_version="$(curl -kLs https://github.com/carlospolop/PEASS-ng/releases/latest -o /dev/null -w "%{url_effective}\n" | awk -F'/' '{print $8}')"
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/download/${winPEAS_version}/winPEAS.bat" -o "../infra/windows-privesc/winPEAS.bat"
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/download/20220925/winPEASany.exe" -o "../infra/windows-privesc/winPEASany.exe"
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/download/20220925/winPEASx64_ofs.exe" -o "../infra/windows-privesc/winPEASx64_ofs.exe"
echo "Done!"
