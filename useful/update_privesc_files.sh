#!/bin/bash

echo -n "Updating files to Linux PrivEsc... "
rm -f "../infra/linux-privesc/lse.sh" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh" -o "../infra/linux-privesc/lse.sh"
chmod +x "../infra/linux-privesc/lse.sh"

rm -f "../infra/linux-privesc/LinEnum.sh" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh" -o "../infra/linux-privesc/LinEnum.sh"
chmod +x "../infra/linux-privesc/LinEnum.sh"

rm -f "../infra/linux-privesc/linpeas.sh" 2> /dev/null
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh" -o "../infra/linux-privesc/linpeas.sh"
chmod +x "../infra/linux-privesc/linpeas.sh"

rm -f ../infra/linux-privesc/{linuxprivchecker.sh,linuxprivchecker.py,linuxprivchecker_async.py}
curl -kLs "https://raw.githubusercontent.com/linted/linuxprivchecker/master/linuxprivchecker.sh" -o "../infra/linux-privesc/linuxprivchecker.sh"
curl -kLs "https://raw.githubusercontent.com/linted/linuxprivchecker/master/linuxprivchecker.py" -o "../infra/linux-privesc/linuxprivchecker.py"
curl -kLs "https://raw.githubusercontent.com/linted/linuxprivchecker/master/linuxprivchecker_async.py" -o "../infra/linux-privesc/linuxprivchecker_async.py"
chmod +x "../infra/linux-privesc/linuxprivchecker.sh"
chmod +x "../infra/linux-privesc/linuxprivchecker.py"
chmod +x "../infra/linux-privesc/linuxprivchecker_async.py"

rm -f "../infra/linux-privesc/unix-privesc-check" 2> /dev/null
curl -kLs "https://pentestmonkey.net/tools/unix-privesc-check/unix-privesc-check-1.4.tar.gz" -o "../infra/linux-privesc/unix-privesc-check-1.4.tar.gz"
tar -xf "../infra/linux-privesc/unix-privesc-check-1.4.tar.gz" -C "../infra/linux-privesc/" unix-privesc-check-1.4/unix-privesc-check --strip-components 1
rm -f "../infra/linux-privesc/unix-privesc-check-1.4.tar.gz" 2> /dev/null

rm -f "../infra/linux-privesc/linux-exploit-suggester-2.pl"
curl -kLs "https://raw.githubusercontent.com/jondonas/linux-exploit-suggester-2/master/linux-exploit-suggester-2.pl" -o "../infra/linux-privesc/linux-exploit-suggester-2.pl"
chmod +x "../infra/linux-privesc/linux-exploit-suggester-2.pl"

rm -f "../infra/linux-privesc/linux-exploit-suggester.sh"
curl -kLs "https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh" -o "../infra/linux-privesc/linux-exploit-suggester.sh"
chmod +x "../infra/linux-privesc/linux-exploit-suggester.sh"

rm -f "../infra/linux-privesc/suid3num.py"
curl -kLs "https://raw.githubusercontent.com/Anon-Exploiter/SUID3NUM/master/suid3num.py" -o "../infra/linux-privesc/suid3num.py"
chmod +x "../infra/linux-privesc/suid3num.py"

rm -f ../infra/linux-privesc/{pspy32,pspy64}
pyspy_version=$(curl -kLs https://github.com/DominicBreuker/pspy/releases/latest -o /dev/null -w "%{url_effective}\n" | awk -F'/' '{print $8}')
curl -kLs "https://github.com/DominicBreuker/pspy/releases/download/${pyspy_version}/pspy32" -o "../infra/linux-privesc/pspy32"
curl -kLs "https://github.com/DominicBreuker/pspy/releases/download/${pyspy_version}/pspy64" -o "../infra/linux-privesc/pspy64"
chmod +x "../infra/linux-privesc/pspy32"
chmod +x "../infra/linux-privesc/pspy64"
echo "Done!"

echo -n "Updating files and binaries to Windows PrivEsc... "
rm -f ../infra/windows-privesc/{accesschk.exe,accesschk64.exe,accesschk64a.exe} 2> /dev/null
curl -kLs "https://download.sysinternals.com/files/AccessChk.zip" -o "../infra/windows-privesc/AccessChk.zip"
unzip -q -o -d ../infra/windows-privesc/ ../infra/windows-privesc/AccessChk.zip
rm -f ../infra/windows-privesc/{AccessChk.zip,Eula.txt} 2> /dev/null

rm -f "../infra/windows-privesc/Acl-FullControl.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/Hackplayers/PsCabesha-tools/master/Privesc/Acl-FullControl.ps1" -o "../infra/windows-privesc/Acl-FullControl.ps1"

if [ ! -s "../infra/windows-privesc/CreateShortcut.vbs" ]; then
echo 'Rem by Tib3rius https://github.com/Tib3rius

Set oWS = WScript.CreateObject("WScript.Shell")
sLinkFile = "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\reverse.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = "C:\PrivEsc\reverse.exe"
oLink.Save' > "../infra/windows-privesc/CreateShortcut.vbs"
fi

rm -f "../infra/windows-privesc/convert_binary_file_to_base64.ps1"
curl -kLs "https://gist.githubusercontent.com/jdmallen/82c4be9cf0f6c86cd8911a4af13848d9/raw/b6ea60f2751be02db7c15860668678910531d2db/convert_binary_file_to_base64.ps1" -o "../infra/windows-privesc/convert_binary_file_to_base64.ps1"

rm -f ../infra/windows-privesc/{cve-2018-8120-x64.exe,cve-2018-8120-x86.exe} 2> /dev/null
curl -kLs "https://github.com/SecWiki/windows-kernel-exploits/raw/master/CVE-2018-8120/x64.exe" -o "../infra/windows-privesc/cve-2018-8120-x64.exe"
curl -kLs "https://github.com/SecWiki/windows-kernel-exploits/raw/master/CVE-2018-8120/x86.exe" -o "../infra/windows-privesc/cve-2018-8120-x86.exe"

rm -f ../infra/windows-privesc/{JuicyPotato.exe,juicypotato.zip}
curl -kLs "https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe" -o "../infra/windows-privesc/JuicyPotato.exe"
curl -kLs "https://github.com/ohpe/juicy-potato/archive/refs/tags/v0.1.zip" -o "../infra/windows-privesc/juicypotato.zip"

rm -f "../infra/windows-privesc/mimikatz_trunk.zip" 2> /dev/null
mimikatz_download="$(curl -kLs https://github.com/gentilkiwi/mimikatz/releases/latest -o /dev/null -w "%{url_effective}\n" | sed "s/tag/download/")/mimikatz_trunk.zip"
curl -kLs "${mimikatz_download}" -o "../infra/windows-privesc/mimikatz_trunk.zip"

rm -f ../infra/windows-privesc/{plink-x64.exe,plink-x86.exe} 2> /dev/null
curl -kLs "https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe" -o "../infra/windows-privesc/plink-x64.exe"
curl -kLs "https://the.earth.li/~sgtatham/putty/latest/w32/plink.exe" -o "../infra/windows-privesc/plink-x86.exe"

rm -f "../infra/windows-privesc/PrivescCheck.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1" -o "../infra/windows-privesc/PrivescCheck.ps1"

rm -f ../infra/windows-privesc/{PrintSpoofer32.exe,PrintSpoofer64.exe} 2> /dev/null
curl -kLs "https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer32.exe" -o "../infra/windows-privesc/PrintSpoofer32.exe"
curl -kLs "https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe" -o "../infra/windows-privesc/PrintSpoofer64.exe"

rm -f "../infra/windows-privesc/PowerUp.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1" -o "../infra/windows-privesc/PowerUp.ps1"

rm -f "../infra/windows-privesc/PowerView.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1" -o "../infra/windows-privesc/PowerView.ps1"

rm -f ../infra/windows-privesc/{Procmon.exe,Procmon64.exe} 2> /dev/null
curl -kLs "https://download.sysinternals.com/files/ProcessMonitor.zip" -o "../infra/windows-privesc/ProcessMonitor.zip"
unzip -q -o -d ../infra/windows-privesc/ ../infra/windows-privesc/ProcessMonitor.zip
rm -f ../infra/windows-privesc/{procmon.chm,Procmon64a.exe,Eula.txt,ProcessMonitor.zip} 2> /dev/null

rm -f ../infra/windows-privesc/{PsExec.exe,PsExec64.exe} 2> /dev/null
curl -kLs "https://download.sysinternals.com/files/PSTools.zip" -o "../infra/windows-privesc/PSTools.zip"
unzip -q -j "../infra/windows-privesc/PSTools.zip" "PsExec.exe" -d "../infra/windows-privesc/"
unzip -q -j "../infra/windows-privesc/PSTools.zip" "PsExec64.exe" -d "../infra/windows-privesc/"
rm -f "../infra/windows-privesc/PSTools.zip" 2> /dev/null

rm -f "../infra/windows-privesc/Seatbelt.exe" 2> /dev/null
curl -kLs "https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Seatbelt.exe" -o "../infra/windows-privesc/Seatbelt.exe"

rm -f "../infra/windows-privesc/setup.bat" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/Tib3rius/Windows-PrivEsc-Setup/master/setup.bat" -o "../infra/windows-privesc/setup.bat"

rm -f "../infra/windows-privesc/SharpHound.exe" 2> /dev/null
curl -kLs "https://github.com/BloodHoundAD/BloodHound/raw/master/Collectors/SharpHound.exe" -o "../infra/windows-privesc/SharpHound.exe"

rm -f "../infra/windows-privesc/SharpHound.ps1" 2> /dev/null
curl -kLs "https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1" -o "../infra/windows-privesc/SharpHound.ps1"

rm -f "../infra/windows-privesc/SharUp.exe" 2> /dev/null
curl -kLs "https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/SharpUp.exe" -o "../infra/windows-privesc/SharpUp.exe"

rm -f "../infra/windows-privesc/RoguePotato.exe" 2> /dev/null
curl -kLs "https://github.com/antonioCoco/RoguePotato/releases/download/1.0/RoguePotato.zip" -o "../infra/windows-privesc/RoguePotato.zip"
unzip -q -j "../infra/windows-privesc/RoguePotato.zip" "RoguePotato.exe" -d "../infra/windows-privesc/" 
rm -f "../infra/windows-privesc/RoguePotato.zip" 2> /dev/null

rm -f "../infra/windows-privesc/Rubeus.exe" 2> /dev/null
curl -kLs "https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe" -o "../infra/windows-privesc/Rubeus.exe"

rm -f ../infra/windows-privesc/{winPEAS.bat,winPEASany.exe,winPEASany_ofs.exe} 2> /dev/null
winPEAS_version="$(curl -kLs https://github.com/carlospolop/PEASS-ng/releases/latest -o /dev/null -w "%{url_effective}\n" | awk -F'/' '{print $8}')"
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/download/${winPEAS_version}/winPEAS.bat" -o "../infra/windows-privesc/winPEAS.bat"
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/download/${winPEAS_version}/winPEASany.exe" -o "../infra/windows-privesc/winPEASany.exe"
curl -kLs "https://github.com/carlospolop/PEASS-ng/releases/download/${winPEAS_version}/winPEASany_ofs.exe" -o "../infra/windows-privesc/winPEASany_ofs.exe"
echo "Done!"
